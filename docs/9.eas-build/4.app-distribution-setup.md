# App Distribution Setup (EAS Submit)

## Prerequisites Checklist

### iOS App Store Requirements
- [ ] **Apple Developer Account** ✅ (Already enrolled - Personal account)
- [ ] **App Store Connect App** - Create app in App Store Connect
- [ ] **App Store Connect API Key** (Optional - for automation)
- [ ] **App Icon** - 1024x1024px
- [ ] **Privacy Policy URL** - Required for App Store
- [ ] **App Screenshots** - Various iOS device sizes
- [ ] **App Description & Keywords**
- [ ] **Age Rating / Content Rating**
- [ ] **Export Compliance** ✅ (Already set: `ITSAppUsesNonExemptEncryption: false`)

### Google Play Store Requirements
- [ ] **Google Play Developer Account** ($25 one-time fee)
- [ ] **Google Play Console App** - Create app in console
- [ ] **Service Account Key** - For automated submissions
- [ ] **App Icon** - 512x512px
- [ ] **Privacy Policy URL** - Required
- [ ] **Feature Graphic** - 1024x500px
- [ ] **App Screenshots** - Phone and tablet
- [ ] **App Description**
- [ ] **Content Rating Questionnaire**

## Step-by-Step Setup

### Phase 1: Apple App Store Connect Setup

#### 1. Create App in App Store Connect
1. Go to [App Store Connect](https://appstoreconnect.apple.com)
2. Navigate to "My Apps" → Click "+" → "New App"
3. Fill in details:
   - **Platform:** iOS
   - **Name:** Journey to Citizen
   - **Primary Language:** English
   - **Bundle ID:** `com.kodianlabs.journeytocitizen` ✅
   - **SKU:** `journey-to-citizen` (unique identifier)
4. Note the **App Store ID** (numeric ID like `1234567890`)

#### 2. Update eas.json with App Store ID
```bash
# Replace "placeholder" in eas.json with your actual App Store ID
# apps/frontend/eas.json → submit.production.ios.ascAppId
```

#### 3. Complete App Information
- **App Privacy:** Add privacy policy URL
- **App Information:** 
  - Category: Productivity or Reference
  - Content Rights: Check if you have rights
- **Pricing:** Free
- **App Review Information:** 
  - Contact info
  - Demo account (if login required)

#### 4. Submit iOS Build
```bash
cd apps/frontend

# Option 1: Submit after build completes
pnpm run build:ios:prod
eas submit -p ios --latest

# Option 2: Submit specific build
eas submit -p ios --id <build-id>
```

**First-time submission will prompt for:**
- Apple ID credentials (already logged in ✅)
- App Store Connect API key (optional)
- Two-factor authentication code

### Phase 2: Google Play Console Setup

#### 1. Create Google Play Developer Account
1. Go to [Google Play Console](https://play.google.com/console)
2. Pay $25 one-time registration fee
3. Complete account setup

#### 2. Create App in Play Console
1. Click "Create app"
2. Fill in details:
   - **App name:** Journey to Citizen
   - **Default language:** English
   - **App type:** App
   - **Free or paid:** Free
3. Accept declarations

#### 3. Set Up App Content
Complete all required sections:
- **App access:** Full access / Limited access
- **Ads:** Does app contain ads? (No)
- **Content rating:** Complete questionnaire
- **Target audience:** Age groups
- **News app:** No
- **COVID-19 contact tracing:** No
- **Data safety:** Privacy practices
- **Government app:** No

#### 4. Create Service Account for Automated Submissions

**a. Enable Google Play Android Developer API:**
1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Create or select project
3. Enable "Google Play Android Developer API"

**b. Create Service Account:**
1. In Cloud Console → IAM & Admin → Service Accounts
2. Create service account:
   - Name: `eas-submit-bot`
   - Grant role: None needed here
3. Create key (JSON format)
4. Download and save as `pc-api-key.json`

**c. Grant Permissions in Play Console:**
1. Play Console → Settings → API access
2. Link project (if not linked)
3. Grant permissions to service account:
   - View app information
   - Create and edit releases
   - Release to testing tracks

**d. Save Service Account Key:**
```bash
# Save JSON key file (keep this secure!)
# Option 1: Use as file
mv ~/Downloads/your-key.json apps/frontend/pc-api-key.json

# Option 2: Use EAS Secret (recommended for security)
eas secret:create --scope project --name PLAY_STORE_SERVICE_ACCOUNT_KEY --type file --value ./pc-api-key.json
```

#### 5. Update eas.json
If using EAS Secret, update `eas.json`:
```json
"android": {
  "serviceAccountKeyPath": "./pc-api-key.json",
  "track": "internal"
}
```

#### 6. Submit Android Build
```bash
cd apps/frontend

# Option 1: Submit after build completes
pnpm run build:android:prod
eas submit -p android --latest

# Option 2: Submit specific build
eas submit -p android --id <build-id>
```

**Available tracks:**
- `internal` - Internal testing (up to 100 testers)
- `alpha` - Closed testing
- `beta` - Open testing
- `production` - Live on Play Store

### Phase 3: Prepare App Store Assets

#### Required Assets for Both Stores

**1. App Icon**
- iOS: 1024x1024px (no transparency, no rounded corners)
- Android: 512x512px (can have transparency)

**2. Screenshots**
- iOS: Various sizes for different devices
  - iPhone 6.7" (e.g., iPhone 15 Pro Max)
  - iPhone 6.5" (e.g., iPhone 14 Plus)
  - iPhone 5.5" (older devices)
  - iPad Pro 12.9"
- Android: 
  - Phone: 16:9 or 9:16 ratio
  - 7-inch tablet
  - 10-inch tablet

**3. Privacy Policy**
- Host on a public URL
- Must cover:
  - What data you collect
  - How you use it
  - Third-party services (Firebase)
  - User rights

**4. App Description**
Example structure:
```
Journey to Citizen helps newcomers to Canada track their path to citizenship.

KEY FEATURES:
• Track your residency days for citizenship eligibility
• Log travel absences from Canada
• Calculate your earliest application date
• Manage important documents
• Set reminders for key milestones

SECURE & PRIVATE:
Your data is securely stored and never shared.

Note: This app provides estimates only. Always verify with official IRCC resources.
```

## Quick Reference Commands

### Build & Submit (Production)
```bash
# iOS
cd apps/frontend
pnpm run build:ios:prod
eas submit -p ios --latest

# Android
pnpm run build:android:prod
eas submit -p android --latest

# Both platforms
eas build --platform all --profile production
eas submit --platform all --latest
```

### Check Build/Submit Status
```bash
# List builds
eas build:list

# View specific build
eas build:view <build-id>

# List submissions
eas submit:list
```

### Internal Testing (Before Production)
```bash
# Build for internal testing
eas build --platform all --profile preview

# Distribute via Expo
eas build:run --profile preview
```

## What You're Currently Missing

### Immediate Blockers:
1. ❌ **App Store Connect App** - Must create app before first submission
2. ❌ **Google Play Developer Account** - Must register and pay $25
3. ❌ **Service Account Key** (Android) - For automated submissions
4. ❌ **Privacy Policy URL** - Required for both stores

### Nice to Have (Can add later):
5. ⚠️ **App Screenshots** - Can upload after first submission
6. ⚠️ **App Icon** (current one works but may need polish)
7. ⚠️ **Store Listings** - Descriptions, keywords, etc.

### Already Complete:
- ✅ Apple Developer Account
- ✅ Distribution Certificate & Provisioning Profile
- ✅ Bundle Identifier registered
- ✅ Export Compliance setting
- ✅ EAS Build configuration
- ✅ Both platform builds working

## Next Steps

1. **Create App Store Connect App** (5 minutes)
   - Get App Store ID (ascAppId)
   - Update eas.json

2. **Register Google Play Developer Account** ($25 + 15 minutes)
   - Create app in Play Console
   - Complete required sections

3. **Create Privacy Policy** (1 hour)
   - Host on GitHub Pages, website, or privacy policy generator
   - Add URL to both stores

4. **First Submission** (15 minutes each platform)
   - iOS: `eas submit -p ios --latest`
   - Android: `eas submit -p android --latest`

5. **Complete Store Listings** (2-3 hours)
   - Screenshots
   - Descriptions
   - Assets

## Timeline Estimate

- **Minimum (just submit):** 1-2 hours
- **Complete (with assets):** 4-6 hours
- **App Review:** 
  - iOS: 24-48 hours typically
  - Android: Few hours to 1 day

## Important Notes

- ⚠️ **First iOS submission:** Apple reviews more carefully, may take longer
- ⚠️ **Beta Testing:** Consider using TestFlight (iOS) and Internal Testing (Android) before production
- ⚠️ **Service Account Key:** Keep `pc-api-key.json` secure, add to `.gitignore`
- ⚠️ **Two-factor Authentication:** Make sure it's enabled for Apple ID
- ✅ **EAS handles:** Certificate management, code signing, build versioning

## Useful Links

- [EAS Submit Documentation](https://docs.expo.dev/submit/introduction/)
- [App Store Connect](https://appstoreconnect.apple.com)
- [Google Play Console](https://play.google.com/console)
- [Privacy Policy Generator](https://www.freeprivacypolicy.com/)
- [App Icon Generator](https://www.appicon.co/)
- [Screenshot Generator](https://www.screely.com/)
