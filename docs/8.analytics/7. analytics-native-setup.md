# Native Firebase Setup for iOS & Android

## Overview
To enable Firebase Analytics (and other Firebase services) on iOS and Android, you need to download platform-specific configuration files from the Firebase Console and configure your Expo app.

---

## Step 1: Download Configuration Files from Firebase Console

### For Android (`google-services.json`)

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Select your project: **journey-to-citizen**
3. Click the **gear icon** (‚öôÔ∏è) next to "Project Overview" ‚Üí **Project settings**
4. Scroll down to **Your apps** section
5. Look for an **Android app** or click **Add app** ‚Üí **Android**
6. If creating new Android app:
   - **Android package name**: `com.kodianlabs.journeytocitizen`
   - **App nickname**: `Journey to Citizen (Android)` (optional)
   - **Debug signing certificate SHA-1**: (optional for now)
   - Click **Register app**
7. Download `google-services.json`
8. Click **Next** ‚Üí **Next** ‚Üí **Continue to console**

### For iOS (`GoogleService-Info.plist`)

1. In the same **Project settings** page
2. Look for an **iOS app** or click **Add app** ‚Üí **iOS**
3. If creating new iOS app:
   - **iOS bundle ID**: `com.kodianlabs.journeytocitizen`
   - **App nickname**: `Journey to Citizen (iOS)` (optional)
   - **App Store ID**: (leave empty for now)
   - Click **Register app**
4. Download `GoogleService-Info.plist`
5. Click **Next** ‚Üí **Next** ‚Üí **Continue to console**

---

## Step 2: Place Configuration Files

### ‚ö†Ô∏è DO NOT commit these files to git!

Add to `.gitignore`:
```
# Firebase config files (contain sensitive keys)
google-services.json
GoogleService-Info.plist
```

### File Locations:

1. Create directories if they don't exist:
   ```bash
   mkdir -p android/app
   mkdir -p ios
   ```

2. Place the files:
   - **Android**: `android/app/google-services.json`
   - **iOS**: `ios/GoogleService-Info.plist`

---

## Step 3: Install React Native Firebase App Module

```bash
cd /Users/kushalarora/Documents/code/journey-to-citizen/apps/frontend
pnpm add @react-native-firebase/app
```

This is the **core module** required for all React Native Firebase packages.

---

## Step 4: Configure Expo to Use Firebase

Update `app.json` to include the Firebase plugin:

```json
{
  "expo": {
    "plugins": [
      "expo-router",
      "@react-native-firebase/app"
    ]
  }
}
```

---

## Step 5: Prebuild Native Projects

Since you're using Expo with native modules, you need to generate the native projects:

```bash
# This will generate ios/ and android/ folders with all native code
npx expo prebuild --clean
```

This command will:
- Generate native iOS and Android projects
- Copy your config files to the right locations
- Configure the Firebase SDK
- Install native dependencies

---

## Step 6: Build and Test

### For iOS (Simulator):
```bash
npx expo run:ios
```

### For Android (Emulator):
```bash
npx expo run:android
```

### For Web (no changes needed):
```bash
npx expo start
# Press 'w' for web
```

---

## Verification

Once running on iOS or Android, check the logs:

**iOS (Xcode):**
- You should see: `‚úì Firebase Auth persistence enabled (React Native - automatic)`
- No errors about missing configuration

**Android (Logcat):**
- You should see Firebase initialization logs
- No errors about missing `google-services.json`

**Test Analytics:**
```typescript
// In your app, trigger any event
// Check Firebase Console ‚Üí Analytics ‚Üí DebugView (with debug mode enabled)
```

---

## Troubleshooting

### ‚ùå Error: "Unable to locate google-services.json"
- Ensure the file is at `android/app/google-services.json`
- Run `npx expo prebuild --clean` again

### ‚ùå Error: "Unable to locate GoogleService-Info.plist"
- Ensure the file is at `ios/GoogleService-Info.plist`
- Run `npx expo prebuild --clean` again

### ‚ùå Build errors after adding Firebase
- Clean build: `cd android && ./gradlew clean && cd ..`
- Clean iOS: `cd ios && rm -rf Pods Podfile.lock && pod install && cd ..`
- Prebuild again: `npx expo prebuild --clean`

### ‚ùå Analytics events not appearing
- Enable debug mode (see `ANALYTICS_DEBUG.md`)
- Check that package name/bundle ID matches Firebase Console
- Verify config files are not corrupted (valid JSON/plist format)

---

## Security Notes

‚ö†Ô∏è **Important**: The configuration files contain API keys and are **NOT secrets**. They identify your Firebase project but are safe to include in client apps. However:

1. **Enable Firebase App Check** in production to prevent abuse
2. **Set up Firestore Security Rules** properly
3. **Use Firebase Auth** to protect sensitive data
4. **Don't commit** config files to public repos (use environment-specific configs)

For this project, since the repo might be public, consider using:
- Different Firebase projects for dev/staging/production
- Environment-specific configuration files
- Firebase App Check for additional security

---

## Next Steps After Setup

1. ‚úÖ Download config files from Firebase Console
2. ‚úÖ Add to `.gitignore`
3. ‚úÖ Place files in correct locations
4. ‚úÖ Install `@react-native-firebase/app`
5. ‚úÖ Update `app.json` with Firebase plugin
6. ‚úÖ Run `npx expo prebuild --clean`
7. ‚úÖ Test on iOS/Android simulators/emulators
8. ‚úÖ Verify analytics in Firebase Console

Once complete, your Firebase Analytics will work across **all platforms**: Web, iOS, and Android! üéâ
