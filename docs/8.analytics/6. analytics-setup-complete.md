# Firebase Analytics Setup - Complete Documentation

**Date**: January 2025  
**Status**: ‚úÖ Web Complete | ‚è≥ Native Pending Config Files

---

## Overview

Firebase Analytics has been implemented across the entire application to track user behavior, feature usage, and engagement metrics. The implementation is cross-platform, working on Web, iOS, and Android.

---

## Current Status

### ‚úÖ Completed
- **Web Analytics**: Fully configured and operational
- **Cross-platform hook**: `useAnalytics` works on all platforms
- **Comprehensive tracking**: 54+ events across all screens
- **Platform detection**: Automatic `platform` and `platform_version` parameters
- **User ID tracking**: Links events to authenticated users
- **Documentation**: Complete setup and debugging guides

### ‚è≥ Pending User Action
- **iOS Config**: Download `GoogleService-Info.plist` from Firebase Console
- **Android Config**: Download `google-services.json` from Firebase Console
- **Native Build**: Run `npx expo prebuild --clean` after adding config files

---

## Implementation Summary

### Files Modified/Created

#### Core Analytics
- `config/firebase.ts` - Analytics initialization (web)
- `hooks/useAnalytics.ts` - Cross-platform analytics hook
- `context/AuthContext.tsx` - User ID tracking on auth state change

#### Screen Implementations
- `app/(tabs)/index.tsx` - Dashboard (13 events)
- `app/(tabs)/absences.tsx` - Travel Absences (13+ events)
- `app/(tabs)/profile.tsx` - Profile (25+ events)
- `app/(tabs)/_layout.tsx` - Navigation (3 events)
- `components/WebNavigationBar.tsx` - Web navigation tracking

#### Documentation
- `docs/8.analytics/` - Complete analytics documentation
  - `1. analytics-implementation.md` - Setup guide
  - `2. analytics-events.md` - Implementation checklist
  - `3. analytics-events-reference.md` - Event catalog
  - `4. platform-tracking-guide.md` - Cross-platform details
  - `5. pressable-vs-touchable.md` - Component patterns
  - `README.md` - Analytics overview
  - `quick-start.md` - Developer reference
- `NATIVE_FIREBASE_SETUP.md` - Native setup instructions
- `ANALYTICS_DEBUG.md` - Debugging guide
- `FIREBASE_SETUP_CHECKLIST.md` - Quick checklist

---

## Event Tracking

### Total Events: 54+

#### Authentication (2 events)
- `sign_up` - New user registration
- `login` - User login

#### Navigation (3 events)
- `header_logo_click` - Main logo clicks
- `nav_item_click` - Navigation menu clicks
- `logout_click` - Logout button clicks

#### Dashboard (13 events)
- `dashboard_click` - All dashboard interactions
  - greeting_section, email_verification_warning
  - upcoming_trips_alert, complete_profile_button
  - eligibility_status_card, progress_card
  - stat_card_click (3 types), calculation_card
  - quick_action_*, disclaimer_click

#### Travel Absences (13+ events)
- `absences_action` - All absence interactions
  - important_rules_click
  - filter_click (Past/Current/Upcoming/Total)
  - add_trip_attempt, add_trip_success, add_trip_error
  - edit_trip_*, delete_trip_*
  - overlap_detected, tip_section_click

#### Profile (25+ events)
- `profile_action` - All profile interactions
  - edit_name_*, edit_email_*
  - edit_pr_date_*, edit_entry_date_*
  - edit_status_*, edit_visitor_stays_*
  - helper_text_click (2 types)

### Event Parameters

All events include:
- `platform`: 'web', 'ios', or 'android'
- `platform_version`: Platform-specific version
- Context-specific parameters (e.g., `has_complete_profile`, `trip_count`)

---

## Testing & Debugging

### Web Testing
1. **DebugView (Recommended)**:
   - Add `?debug_mode=true` to URL
   - OR install [Google Analytics Debugger](https://chrome.google.com/webstore/detail/google-analytics-debugger/jnkmfdileelhofjcijamephohjechhna)
   - Check Firebase Console ‚Üí Analytics ‚Üí DebugView
   - Events appear within seconds

2. **Browser Console**:
   - Open DevTools
   - Look for: `‚úì Firebase Analytics initialized`
   - Verify no errors about blocked requests

3. **Network Tab**:
   - Filter by "google-analytics" or "collect"
   - Should see POST requests on user actions

### Native Testing (After Config Files Added)

**iOS**:
```bash
# In Xcode: Product ‚Üí Scheme ‚Üí Edit Scheme ‚Üí Arguments
# Add: -FIRAnalyticsDebugEnabled
npx expo run:ios
```

**Android**:
```bash
adb shell setprop debug.firebase.analytics.app com.kushalarora92.journeytocitizen
npx expo run:android
```

### Production Verification
- Events automatically sent to Firebase
- View in Firebase Console ‚Üí Analytics ‚Üí Events
- Data appears within 24 hours
- No debug mode needed in production

---

## Component Patterns

### Pressable vs TouchableOpacity

**Pressable** (Informational tracking - no visual feedback):
```tsx
<Pressable 
  style={[styles.infoCard, { cursor: 'auto' }]}
  onPress={() => trackEvent('info_click')}
>
  <Text>Informational content</Text>
</Pressable>
```
- Used for tracking interest in informational sections
- No opacity change on press
- `cursor: 'auto'` prevents pointer cursor on web

**TouchableOpacity** (Action buttons - visual feedback):
```tsx
<TouchableOpacity 
  style={styles.actionButton}
  onPress={() => {
    trackEvent('button_click');
    performAction();
  }}
>
  <Text>Action Button</Text>
</TouchableOpacity>
```
- Used for primary actions (buttons, cards that navigate)
- Opacity feedback on press
- Default pointer cursor on web

---

## Architecture

### Web Implementation
- Uses `firebase/analytics` from Firebase JS SDK v12.3.0
- Initialized in `config/firebase.ts`
- Async initialization with `isSupported()` check
- Gracefully handles ad blockers

### Native Implementation
- Uses `@react-native-firebase/analytics` v23.4.1
- Requires native config files:
  - `google-services.json` (Android)
  - `GoogleService-Info.plist` (iOS)
- Initialized automatically on app start
- No web bundle overhead

### Unified Interface
```typescript
const { trackEvent, trackScreenView, setAnalyticsUserId } = useAnalytics();

// Track custom event
trackEvent('button_click', { button_name: 'submit' });

// Track screen view
trackScreenView('Dashboard', { user_type: 'premium' });

// Set user ID (done automatically in AuthContext)
setAnalyticsUserId(user.uid);
```

---

## Security & Privacy

### Data Collection
- **Anonymous by default**: Events tracked without PII
- **User ID**: Only Firebase Auth UID (no email/name in events)
- **Opt-out ready**: Can add user preference for analytics

### API Keys
- Config files contain public API keys (safe for client apps)
- API keys identify Firebase project
- **NOT secrets** - safe in client code
- Protected by Firebase security rules

### Best Practices
- ‚úÖ No PII in event parameters
- ‚úÖ User ID is Firebase Auth UID only
- ‚úÖ Config files in `.gitignore`
- ‚úÖ Analytics data in Firebase (GDPR compliant)
- ‚è≥ TODO: Add user preference for analytics opt-out

---

## Next Steps for Native Support

### Required Actions
1. **Download Config Files** from Firebase Console:
   - [Project Settings](https://console.firebase.google.com/project/journey-to-citizen/settings/general)
   - Add Android app (if not exists): `com.kushalarora92.journeytocitizen`
   - Add iOS app (if not exists): `com.kushalarora92.journeytocitizen`
   - Download both config files

2. **Place Config Files**:
   ```bash
   cd apps/frontend
   mkdir -p android/app ios
   # Copy google-services.json to android/app/
   # Copy GoogleService-Info.plist to ios/
   ```

3. **Generate Native Projects**:
   ```bash
   npx expo prebuild --clean
   ```

4. **Test on Simulators**:
   ```bash
   npx expo run:ios
   npx expo run:android
   ```

5. **Verify in Firebase Console**:
   - Enable debug mode (see `ANALYTICS_DEBUG.md`)
   - Check Analytics ‚Üí DebugView
   - Trigger events and verify they appear

### Future Enhancements
- [ ] Add user preference for analytics opt-out
- [ ] Implement custom conversion events
- [ ] Add user properties (subscription tier, etc.)
- [ ] Set up custom audiences for targeted features
- [ ] Implement funnel tracking for key user flows
- [ ] Add performance monitoring
- [ ] Set up A/B testing with Remote Config

---

## Troubleshooting

See detailed troubleshooting in:
- `ANALYTICS_DEBUG.md` - Complete debugging guide
- `NATIVE_FIREBASE_SETUP.md` - Native setup issues

Common issues:
- **Ad blockers**: Disable for testing
- **Missing config files**: Download from Firebase Console
- **Build errors**: Run `npx expo prebuild --clean`
- **Events not appearing**: Enable DebugView
- **24h delay**: Normal for production, use DebugView for testing

---

## Success Criteria

### ‚úÖ Implementation Complete When:
- [x] Analytics events firing on web
- [ ] Config files downloaded and placed
- [ ] Native builds working on iOS
- [ ] Native builds working on Android
- [ ] Events visible in DebugView
- [ ] All 54+ events tracked correctly
- [ ] User ID tracking operational
- [ ] Documentation complete

### üéâ Ready for Production When:
- [ ] All success criteria met
- [ ] Tested on physical devices
- [ ] Events verified in Firebase Console
- [ ] Team trained on viewing analytics
- [ ] Privacy policy updated (if required)

---

## References

- [Firebase Analytics Documentation](https://firebase.google.com/docs/analytics)
- [React Native Firebase Documentation](https://rnfirebase.io/)
- [Expo Firebase Configuration](https://docs.expo.dev/guides/using-firebase/)
- [Analytics DebugView Guide](https://firebase.google.com/docs/analytics/debugview)

---

**Last Updated**: January 2025  
**Maintainer**: Development Team  
**Status**: Web ‚úÖ | Native ‚è≥ (Pending config files)
